<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WalletConnect + Solana Demo</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; }
    button { padding: 0.5rem 1rem; font-size: 1rem; }
    #address, #balance { margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>
  <h1>WalletConnect + Solana</h1>
  <button id="connect">Mit Wallet verbinden</button>
  <div id="address">Adresse: –</div>
  <div id="balance">SOL‑Balance: –</div>

  <script type="module">
    // 1) Import des Universal Provider und Solana‑Adapters von WalletConnect v2
    import UniversalProvider from "https://esm.sh/@walletconnect/universal-provider";
    import { SolanaProvider }    from "https://esm.sh/@walletconnect/solana-adapter";
    // 2) Import der Solana Web3.js‑Klassen zum Abfragen des Kontostandes
    import { Connection, PublicKey, LAMPORTS_PER_SOL, clusterApiUrl }
      from "https://esm.sh/@solana/web3.js";

    // HIER deine Project ID von https://cloud.walletconnect.com/ eintragen:
    const projectId = "DEINE_PROJECT_ID_HIER";
    const chains    = ["solana:mainnet"];

    const btnConnect = document.getElementById("connect");
    const divAddress = document.getElementById("address");
    const divBalance = document.getElementById("balance");

    let solProvider, connection;

    btnConnect.addEventListener("click", async () => {
      try {
        // Initialisiere Universal Provider
        const provider = await UniversalProvider.init({ projectId, chains });
        // Wrappe ihn mit dem Solana‑Adapter
        solProvider = await SolanaProvider.init({ provider });
        // Öffne WalletConnect‑Modal und verbinde
        await solProvider.connect();

        // Adresse(n) abfragen
        const accounts = await solProvider.request({ method: "solana_accounts" });
        const address  = accounts[0];
        divAddress.textContent = `Adresse: ${address}`;

        // Neue Solana‑Connection (Mainnet‑Beta)
        connection = new Connection(clusterApiUrl("mainnet-beta"));

        // Kontostand in Lamports abfragen und in SOL umrechnen
        const lamports = await connection.getBalance(new PublicKey(address));
        divBalance.textContent = `SOL‑Balance: ${lamports / LAMPORTS_PER_SOL} SOL`;
      } catch (err) {
        console.error(err);
        alert("Verbindung fehlgeschlagen: " + err.message);
      }
    });
  </script>
</body>
</html>
