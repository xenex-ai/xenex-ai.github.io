<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ultimate Linux-Befehle Editor – Pro Edition 4.0</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    /* Basis-Reset und Standard-Stile */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html {
      scroll-behavior: smooth;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
      transition: background 0.3s, color 0.3s;
      overflow-x: hidden;
    }
    body.dark-mode {
      background: #1e1e1e;
      color: #ddd;
    }
    /* Fixierte Top-Navigationsleiste */
    nav.topnav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #007bff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      z-index: 300;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }
    nav.topnav .logo {
      font-size: 1.8em;
      color: #fff;
      font-weight: bold;
    }
    nav.topnav .menu {
      display: flex;
      gap: 15px;
    }
    nav.topnav .menu button {
      background: transparent;
      border: none;
      color: #fff;
      font-size: 1em;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 5px;
      transition: background 0.3s, transform 0.2s;
    }
    nav.topnav .menu button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }
    /* Container-Layout: Sidebar & Main-Area */
    .container {
      display: flex;
      flex-direction: row;
      gap: 15px;
      margin-top: 60px; /* Platz für Top-Navigation */
      padding: 20px;
    }
    /* Responsive Anpassung: Sidebar und Main-Bereich untereinander */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .sidebar {
        max-height: none;
      }
    }
    /* Sidebar: Kategorien und Untermenüs */
    .sidebar {
      flex: 0 0 220px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      padding: 15px;
      max-height: calc(100vh - 150px);
      overflow-y: auto;
      transition: background 0.3s, color 0.3s;
    }
    body.dark-mode .sidebar {
      background: #2b2b2b;
    }
    .sidebar h2 {
      font-size: 1.2em;
      margin-bottom: 10px;
      text-align: center;
      color: #007bff;
    }
    .category-item {
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 8px;
      transition: background 0.3s, color 0.3s;
    }
    .category-item:hover,
    .category-item.active {
      background: #007bff;
      color: #fff;
    }
    /* Hauptbereich (Main-Area) */
    .main-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    /* Toolbar (überarbeitet) */
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .toolbar button {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 10px 15px;
      border: 2px solid #007bff;
      border-radius: 30px;
      background: #fff;
      color: #007bff;
      font-size: 0.95em;
      cursor: pointer;
      transition: background 0.3s, color 0.3s, transform 0.2s;
      box-shadow: 0 2px 4px rgba(0, 123, 255, 0.15);
    }
    .toolbar button:hover {
      background: #007bff;
      color: #fff;
      transform: translateY(-3px);
    }
    .toolbar button.active {
      background: #007bff;
      color: #fff;
    }
    .toolbar input[type="file"] {
      display: none;
    }
    /* Suchleiste und zusätzliche Filter */
    .search-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .search-bar input,
    .search-bar select {
      padding: 12px 16px;
      font-size: 1em;
      border: 1px solid #ddd;
      border-radius: 30px;
      outline: none;
      transition: border 0.3s;
    }
    .search-bar input:focus,
    .search-bar select:focus {
      border-color: #007bff;
    }
    /* Befehlsliste (Liste & Grid) */
    #commandList {
      display: flex;
      flex-direction: column;
      gap: 15px;
      min-height: 220px;
      transition: all 0.3s;
    }
    #commandList.grid {
      flex-direction: row;
      flex-wrap: wrap;
    }
    #commandList.grid .command-card {
      flex: 1 1 calc(45% - 15px);
      margin: 7.5px;
    }
    /* Befehlskarten */
    .command-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      align-items: flex-start;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: move;
      position: relative;
    }
    .command-card.dragging {
      opacity: 0.5;
    }
    body.dark-mode .command-card {
      background: #2b2b2b;
      box-shadow: 0 3px 10px rgba(0,0,0,0.5);
    }
    .command-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    }
    .command-content {
      flex: 1;
      min-width: 250px;
      margin-right: 15px;
      margin-bottom: 10px;
    }
    .command-content input[type="text"],
    .command-content textarea {
      width: 100%;
      font-family: Consolas, 'Courier New', monospace;
      font-size: 1em;
      padding: 10px 12px;
      margin-bottom: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      transition: border 0.3s, background 0.3s;
      background: #fafafa;
    }
    body.dark-mode .command-content input[type="text"],
    body.dark-mode .command-content textarea {
      background: #3a3a3a;
      border-color: #555;
      color: #eee;
    }
    .command-content input[type="text"]:focus,
    .command-content textarea:focus {
      border-color: #007bff;
      background: #f0f8ff;
    }
    body.dark-mode .command-content input[type="text"]:focus,
    body.dark-mode .command-content textarea:focus {
      background: #4a4a4a;
      border-color: #66aaff;
    }
    /* Kategorie-Feld */
    .category-field {
      font-size: 0.9em;
      padding: 6px 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-top: 5px;
      background: #fff;
      transition: border 0.3s, background 0.3s;
      width: auto;
    }
    body.dark-mode .category-field {
      background: #3a3a3a;
      border-color: #555;
      color: #eee;
    }
    /* Button-Bereich in den Karten */
    .buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      flex-shrink: 0;
    }
    .buttons button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 10px;
      border-radius: 50%;
      transition: background 0.3s ease, transform 0.2s;
    }
    .buttons button:hover {
      background: rgba(0,123,255,0.15);
      transform: scale(1.1);
    }
    .buttons button svg {
      width: 26px;
      height: 26px;
      fill: #007bff;
    }
    /* Neuer Befehl-Button im Footer */
    footer {
      text-align: center;
      margin-top: 25px;
    }
    #addCommandBtn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 14px 24px;
      font-size: 1.1em;
      border: 2px solid #007bff;
      border-radius: 30px;
      color: #007bff;
      background: #fff;
      cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease, transform 0.2s;
      box-shadow: 0 2px 4px rgba(0,123,255,0.15);
    }
    #addCommandBtn:hover {
      background: #007bff;
      color: #fff;
      transform: translateY(-3px);
    }
    /* Toast-Benachrichtigungen */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.85);
      color: #fff;
      padding: 12px 24px;
      border-radius: 6px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 1100;
      font-size: 0.95em;
    }
    .toast.show { opacity: 1; }
    /* Floating Copy Icon */
    .floating-copy {
      position: fixed;
      right: 30px;
      background: #007bff;
      color: #fff;
      padding: 10px 16px;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1101;
      transition: opacity 0.3s, transform 0.3s;
      opacity: 0;
      font-size: 0.95em;
      user-select: none;
    }
    .floating-copy.show { opacity: 1; }
    .floating-copy::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      right: 0;
      background-color: #333;
      color: #fff;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 0.8em;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      white-space: nowrap;
    }
    .floating-copy:hover::after { opacity: 1; }
    /* Copy Success Feedback */
    .copy-success {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-30px);
      background: #28a745;
      color: #fff;
      padding: 12px 24px;
      border-radius: 6px;
      opacity: 0;
      z-index: 1102;
      transition: opacity 0.5s, transform 0.5s;
      font-size: 1em;
    }
    .copy-success.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    /* Modal-Stile für "Über" und "Hilfe" */
    .modal {
      display: none;
      position: fixed;
      z-index: 1200;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 500px;
      border-radius: 8px;
      position: relative;
    }
    .modal-content h2 {
      margin-bottom: 15px;
    }
    .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5em;
      cursor: pointer;
      color: #aaa;
      transition: color 0.3s;
    }
    .close-modal:hover {
      color: #000;
    }
  </style>
</head>
<body>
  <!-- Top-Navigation -->
  <nav class="topnav">
    <div class="logo">Linux Editor</div>
    <div class="menu">
      <button id="topMenuHome" title="Startseite">Home</button>
      <button id="topMenuAbout" title="Über dieses Tool">Über</button>
      <button id="topMenuHelp" title="Hilfe & Anleitung">Hilfe</button>
    </div>
  </nav>

  <!-- Container mit Sidebar und Hauptbereich -->
  <div class="container">
    <!-- Sidebar: Kategorien -->
    <aside class="sidebar">
      <h2>Kategorien</h2>
      <div id="categorySidebar">
        <!-- Dynamische Kategorieeinträge -->
      </div>
      <button id="clearCategoryBtn" style="margin-top:10px;width:100%;padding:8px;border:1px solid #007bff;background:transparent;border-radius:4px;color:#007bff;transition:background 0.3s;" title="Alle Kategorien anzeigen">Alle anzeigen</button>
    </aside>

    <!-- Hauptbereich -->
    <section class="main-area">
      <!-- Toolbar mit Funktionselementen -->
      <nav class="toolbar" aria-label="Toolbar mit Funktionen">
        <button id="exportBtn" title="Befehle exportieren" aria-label="Exportieren">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5,20h14c1.1,0,2-0.9,2-2V10h-2v8H5V10H3v8C3,19.1,3.9,20,5,20z M19,4h-4V2H9v2H5l7,7L19,4z"></path>
          </svg>
          Export
        </button>
        <button id="importBtn" title="Befehle importieren" aria-label="Importieren">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M19,13v6H5v-6H3v6c0,1.1,0.9,2,2,2h14c1.1,0,2-.9,2-2v-6H19z M11,2L6.5,6.5L8,8l3-3l3,3l1.5-1.5L13,2H11z"></path>
          </svg>
          Import
          <input type="file" id="fileInput" accept=".json" aria-hidden="true" />
        </button>
        <button id="resetBtn" title="Auf Standardbefehle zurücksetzen" aria-label="Reset">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5V1L8 5l4 4V6c3.31,0,6,2.69,6,6 0,1.63-0.66,3.11-1.73,4.19l1.42,1.42C19.07,15.73,20,13.96,20,12c0-4.42-3.58-8-8-8zm-6.36,0.64L4.22,7.06C2.85,8.37,2,10.11,2,12c0,4.42,3.58,8,8,8v4l4-4-4-4v3c-3.31,0-6-2.69-6-6 0-1.24,0.39-2.39,1.04-3.36z"></path>
          </svg>
          Reset
        </button>
        <button id="darkModeBtn" title="Dark Mode umschalten" aria-label="Dark Mode umschalten">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M9.37,5.51A7,7,0,0,0,12,19a7,7,0,0,0,5.49-2.63A9,9,0,1,1,9.37,5.51Z"></path>
          </svg>
          Dark Mode
        </button>
        <button id="favFilterBtn" title="Nur Favoriten anzeigen" class="inactive" aria-label="Favoriten filtern">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12,17.27L18.18,21l-1.64-7.03L22,9.24l-7.19-0.61L12,2,9.19,8.63,2,9.24l5.46,4.73L5.82,21Z"></path>
          </svg>
          Favoriten
        </button>
        <button id="layoutToggleBtn" title="Layout wechseln" aria-label="Layout wechseln">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4,4h6v6H4Zm10,0h6v6h-6Zm-10,10h6v6H4Zm10,0h6v6h-6Z"></path>
          </svg>
          Layout
        </button>
        <button id="sortBtn" title="Sortierung ändern" aria-label="Sortierung ändern">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3,18h6v-2H3v2Zm0-5h12v-2H3v2Zm0-7v2h18V6H3Z"></path>
          </svg>
          Sortieren
        </button>
      </nav>

      <!-- Such- und Filterleiste -->
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Befehl, Beschreibung oder Kategorie suchen..." />
        <select id="categoryFilter">
          <option value="">Alle Kategorien</option>
        </select>
      </div>

      <!-- Befehlsliste -->
      <div id="commandList" aria-live="polite">
        <!-- Dynamische Befehlskarten werden hier eingefügt -->
      </div>

      <!-- Footer: Neuer Befehl -->
      <footer>
        <button id="addCommandBtn" title="Neuen Befehl hinzufügen" aria-label="Neuer Befehl hinzufügen">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19Z"></path>
          </svg>
          Neuer Befehl
        </button>
      </footer>
    </section>
  </div>

  <!-- Modal: Über -->
  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" data-modal="aboutModal">&times;</span>
      <h2>Über dieses Tool</h2>
      <p>Ultimate Linux-Befehle Editor – Pro Edition 4.0<br/>Ein flexibles Frontend für Ihre Linux-Kommandos. Bearbeiten, gruppieren und speichern Sie Ihre Befehle bequem.</p>
    </div>
  </div>

  <!-- Modal: Hilfe -->
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" data-modal="helpModal">&times;</span>
      <h2>Hilfe & Anleitung</h2>
      <p>Verwenden Sie die Suchleiste, um nach Befehlen, Beschreibungen oder Kategorien zu suchen. Nutzen Sie die Schaltflächen in der Toolbar, um Daten zu importieren, exportieren oder Ihre Ansicht zu ändern. Mit Favoriten können Sie besondere Befehle hervorheben.</p>
    </div>
  </div>

  <!-- Toast-Benachrichtigung -->
  <div id="toast" class="toast" role="alert" aria-live="assertive"></div>
  <!-- Floating Copy Icon -->
  <div id="floatingCopy" class="floating-copy" data-tooltip="Kopieren"></div>
  <!-- Copy Success Feedback -->
  <div id="copySuccess" class="copy-success" aria-hidden="true">✔ Kopiert!</div>

  <script>
    /********************
     * ULTIMATE MASTER SCRIPT – Pro Edition 4.0
     * Dieses Skript kombiniert Inline-Bearbeitung, Kategorien (jetzt mit 'Unkategorisiert'-Fallback), Favoriten, Drag & Drop,
     * Export/Import (Daten werden im Cache gespeichert), Reset, Dark Mode sowie Filter- und Menü-Funktionen.
     ********************/

    // Standardbefehle inkl. Kategorie und Favorit-Status
    const defaultCommands = [
      { id: Date.now() + "_1", command: "ls", description: "Zeigt den Inhalt des aktuellen Ordners an", category: "Navigation", favorite: true },
      { id: Date.now() + "_2", command: "cd ordnername", description: "Wechselt in den Ordner 'ordnername'", category: "Navigation", favorite: true },
      { id: Date.now() + "_3", command: "cd ..", description: "Geht einen Ordner nach oben", category: "Navigation", favorite: false },
      { id: Date.now() + "_4", command: "cd /", description: "Wechselt ins Root-Verzeichnis", category: "Navigation", favorite: false },
      { id: Date.now() + "_5", command: "cd ~", description: "Wechselt ins Home-Verzeichnis", category: "Navigation", favorite: false },
      { id: Date.now() + "_6", command: "pwd", description: "Zeigt den aktuellen Pfad an", category: "System", favorite: false },
      { id: Date.now() + "_7", command: "python3 -m venv env", description: "Erstellt eine virtuelle Python-Umgebung", category: "Entwicklung", favorite: false },
      { id: Date.now() + "_8", command: "source env/bin/activate", description: "Aktiviert die virtuelle Umgebung", category: "Entwicklung", favorite: false },
      { id: Date.now() + "_9", command: "tmux new -s sessionname", description: "Erstellt eine neue tmux Session", category: "Terminal", favorite: false },
      { id: Date.now() + "_10", command: "tmux attach -t sessionname", description: "Tritt der vorhandenen tmux Session bei", category: "Terminal", favorite: false }
    ];

    let commands = [];
    let showFavoritesOnly = false;
    let currentCategoryFilter = "";
    let currentSortMode = "default"; // "default" oder "alphabetical"
    let isGridLayout = false;

    // Lokale Speicherung (Cache)
    const saveCommands = () => localStorage.setItem("commands", JSON.stringify(commands));
    const loadCommands = () => {
      const stored = localStorage.getItem("commands");
      if (stored) { 
        commands = JSON.parse(stored); 
      } else {
        commands = defaultCommands;
        saveCommands();
      }
    };

    // Kategorie-Filter (Dropdown & Sidebar) aktualisieren
    const updateCategoryFilterOptions = () => {
      const select = document.getElementById("categoryFilter");
      const sidebar = document.getElementById("categorySidebar");
      // Erstelle ein Set – leere Kategorien werden als "Unkategorisiert" behandelt
      const categoriesSet = new Set();
      commands.forEach(cmd => {
        const cat = cmd.category && cmd.category.trim() !== "" ? cmd.category.trim() : "Unkategorisiert";
        categoriesSet.add(cat);
      });
      const categories = [...categoriesSet].sort();
      
      // Dropdown
      select.innerHTML = `<option value="">Alle Kategorien</option>`;
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      });
      
      // Sidebar
      sidebar.innerHTML = "";
      categories.forEach(cat => {
        const item = document.createElement("div");
        item.className = "category-item";
        item.textContent = cat;
        item.addEventListener("click", () => {
          currentCategoryFilter = cat;
          document.querySelectorAll(".category-item").forEach(el => el.classList.remove("active"));
          item.classList.add("active");
          renderCommands();
        });
        sidebar.appendChild(item);
      });
    };

    // Toast-Funktion
    const showToast = (message) => {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2500);
    };

    // Copy-Success Feedback
    const showCopySuccess = () => {
      const successDiv = document.getElementById("copySuccess");
      successDiv.classList.add("show");
      setTimeout(() => successDiv.classList.remove("show"), 2000);
    };

    // Befehlskarte erstellen (mit Inline-Bearbeitung, Kategorie-Feld und Buttons)
    const createCommandCard = (cmdObj) => {
      const card = document.createElement("article");
      card.className = "command-card";
      card.setAttribute("data-id", cmdObj.id);
      card.setAttribute("tabindex", "0");
      card.draggable = true;

      // Drag & Drop Events
      card.addEventListener("dragstart", (e) => {
        card.classList.add("dragging");
        e.dataTransfer.setData("text/plain", cmdObj.id);
      });
      card.addEventListener("dragend", () => card.classList.remove("dragging"));

      // Inhalt
      const contentDiv = document.createElement("div");
      contentDiv.className = "command-content";

      // Befehlseingabe
      const inputCommand = document.createElement("input");
      inputCommand.type = "text";
      inputCommand.value = cmdObj.command;
      inputCommand.placeholder = "Befehl eingeben";
      inputCommand.setAttribute("aria-label", "Befehl");
      inputCommand.addEventListener("input", () => { 
        cmdObj.command = inputCommand.value; 
        saveCommands(); 
      });

      // Beschreibung
      const inputDesc = document.createElement("textarea");
      inputDesc.value = cmdObj.description;
      inputDesc.placeholder = "Beschreibung eingeben";
      inputDesc.rows = 2;
      inputDesc.setAttribute("aria-label", "Beschreibung");
      inputDesc.addEventListener("input", () => { 
        cmdObj.description = inputDesc.value; 
        saveCommands(); 
      });

      // Kategorie
      const inputCategory = document.createElement("input");
      inputCategory.type = "text";
      inputCategory.value = cmdObj.category && cmdObj.category.trim() !== "" ? cmdObj.category : "";
      inputCategory.placeholder = "Kategorie (z.B. Navigation, System)";
      inputCategory.className = "category-field";
      inputCategory.setAttribute("aria-label", "Kategorie");
      inputCategory.addEventListener("input", () => { 
        cmdObj.category = inputCategory.value;
        saveCommands(); 
        updateCategoryFilterOptions();
      });

      contentDiv.append(inputCommand, inputDesc, inputCategory);

      // Buttons in der Karte
      const buttonsDiv = document.createElement("div");
      buttonsDiv.className = "buttons";

      // Kopier-Button
      const copyBtn = document.createElement("button");
      copyBtn.title = "Befehl kopieren";
      copyBtn.setAttribute("aria-label", "Befehl kopieren");
      copyBtn.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
        </svg>`;
      copyBtn.addEventListener("click", () => {
        const text = inputCommand.value;
        if (navigator.clipboard) {
          navigator.clipboard.writeText(text)
            .then(() => { 
              showToast("Befehl kopiert!");
              showCopySuccess();
            })
            .catch(() => showToast("Fehler beim Kopieren."));
        } else {
          const ta = document.createElement("textarea");
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          try { 
            document.execCommand("copy"); 
            showToast("Befehl kopiert!"); 
            showCopySuccess(); 
          } catch (err) { 
            showToast("Fehler beim Kopieren."); 
          }
          document.body.removeChild(ta);
        }
      });

      // Favoriten-Button
      const favBtn = document.createElement("button");
      favBtn.title = "Als Favorit markieren";
      favBtn.setAttribute("aria-label", "Favorit umschalten");
      favBtn.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-0.61L12 2,9.19 8.63,2 9.24l5.46,4.73L5.82,21z"/>
        </svg>`;
      favBtn.style.fill = cmdObj.favorite ? "#ffa500" : "#007bff";
      favBtn.addEventListener("click", () => {
        cmdObj.favorite = !cmdObj.favorite;
        favBtn.style.fill = cmdObj.favorite ? "#ffa500" : "#007bff";
        saveCommands();
        favBtn.animate([{ transform: "scale(1)" }, { transform: "scale(1.2)" }, { transform: "scale(1)" }], { duration: 300 });
      });

      // Löschen-Button
      const deleteBtn = document.createElement("button");
      deleteBtn.title = "Befehl löschen";
      deleteBtn.setAttribute("aria-label", "Befehl löschen");
      deleteBtn.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M19 13H5V11H19V13Z"/>
        </svg>`;
      deleteBtn.addEventListener("click", () => {
        if (confirm("Diesen Befehl wirklich löschen?")) {
          commands = commands.filter(c => c.id !== cmdObj.id);
          saveCommands();
          renderCommands();
          updateCategoryFilterOptions();
          showToast("Befehl gelöscht.");
        }
      });

      buttonsDiv.append(copyBtn, favBtn, deleteBtn);
      card.append(contentDiv, buttonsDiv);
      return card;
    };

    // Sortierung: Standard oder alphabetisch
    const sortCommands = (cmds) => {
      if (currentSortMode === "alphabetical")
        return cmds.sort((a, b) => a.command.localeCompare(b.command));
      return cmds.sort((a, b) => b.favorite - a.favorite);
    };

    // Befehle rendern (Filter: Suchtext, Kategorie aus Dropdown & Sidebar, Favoriten)
    const renderCommands = () => {
      const listDiv = document.getElementById("commandList");
      listDiv.innerHTML = "";
      const filterText = document.getElementById("searchInput").value.trim().toLowerCase();
      const dropdownCategory = document.getElementById("categoryFilter").value;
      // Wenn im Dropdown "Unkategorisiert" ausgewählt ist, soll nur gefiltert werden, wenn command.category leer ist.
      const categoryFilter = currentCategoryFilter || dropdownCategory;
      const filteredCommands = commands.filter(cmd => {
        const cmdCat = cmd.category && cmd.category.trim() !== "" ? cmd.category.trim() : "Unkategorisiert";
        const matchesSearch = cmd.command.toLowerCase().includes(filterText) ||
                              cmd.description.toLowerCase().includes(filterText) ||
                              cmdCat.toLowerCase().includes(filterText);
        const matchesCategory = categoryFilter ? (categoryFilter === "Unkategorisiert" ? (!cmd.category || cmd.category.trim() === "") : (cmdCat === categoryFilter)) : true;
        return showFavoritesOnly ? (matchesSearch && cmd.favorite && matchesCategory) : (matchesSearch && matchesCategory);
      });
      sortCommands(filteredCommands).forEach(cmd => listDiv.appendChild(createCommandCard(cmd)));
      updateFloatingCopyPosition();
    };

    // Drag & Drop: Reihenfolge aktualisieren
    const commandListDiv = document.getElementById("commandList");
    commandListDiv.addEventListener("dragover", e => {
      e.preventDefault();
      const draggingCard = document.querySelector(".dragging");
      const afterElement = getDragAfterElement(commandListDiv, e.clientY);
      if (!afterElement) commandListDiv.appendChild(draggingCard);
      else commandListDiv.insertBefore(draggingCard, afterElement);
    });
    const getDragAfterElement = (container, y) => {
      const draggableElements = [...container.querySelectorAll(".command-card:not(.dragging)")];
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset)
          return { offset: offset, element: child };
        return closest;
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    };
    const updateOrder = () => {
      const newOrder = [];
      document.querySelectorAll(".command-card").forEach(card => {
        const id = card.getAttribute("data-id");
        const cmd = commands.find(c => c.id === id);
        if (cmd) newOrder.push(cmd);
      });
      commands = newOrder;
      saveCommands();
    };
    const observer = new MutationObserver(updateOrder);
    observer.observe(commandListDiv, { childList: true });

    // Neuen Befehl hinzufügen
    const addNewCommand = () => {
      const newCmd = {
        id: Date.now() + "_" + Math.floor(Math.random() * 1000),
        command: "neuer_befehl",
        description: "Beschreibung",
        category: "",
        favorite: false
      };
      commands.push(newCmd);
      saveCommands();
      renderCommands();
      updateCategoryFilterOptions();
      showToast("Neuer Befehl hinzugefügt!");
    };

    // Export / Import
    const exportCommands = () => {
      const dataStr = JSON.stringify(commands, null, 2);
      const blob = new Blob([dataStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "commands_export.json";
      a.click();
      URL.revokeObjectURL(url);
      showToast("Befehle exportiert!");
    };
    const importCommands = (file) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const imported = JSON.parse(e.target.result);
          if (Array.isArray(imported)) {
            commands = imported;
            saveCommands();
            renderCommands();
            updateCategoryFilterOptions();
            showToast("Befehle importiert!");
          } else showToast("Ungültiges Format!");
        } catch (error) { 
          showToast("Fehler beim Importieren!"); 
        }
      };
      reader.readAsText(file);
    };

    // Reset
    const resetCommands = () => {
      if (confirm("Möchtest du wirklich auf die Standardbefehle zurücksetzen? Alle Änderungen gehen verloren!")) {
        commands = defaultCommands;
        saveCommands();
        renderCommands();
        updateCategoryFilterOptions();
        showToast("Liste zurückgesetzt!");
      }
    };

    // Dark Mode
    const toggleDarkMode = () => { document.body.classList.toggle("dark-mode"); };

    // Favoriten-Filter umschalten
    const toggleFavFilter = () => {
      showFavoritesOnly = !showFavoritesOnly;
      const favBtn = document.getElementById("favFilterBtn");
      favBtn.classList.toggle("active", showFavoritesOnly);
      favBtn.classList.toggle("inactive", !showFavoritesOnly);
      renderCommands();
    };

    // Layout-Toggle zwischen Listen- und Grid-Ansicht
    const toggleLayout = () => {
      isGridLayout = !isGridLayout;
      const listDiv = document.getElementById("commandList");
      isGridLayout ? listDiv.classList.add("grid") : listDiv.classList.remove("grid");
    };

    // Sortierung ändern (Standard oder alphabetisch)
    const changeSortMode = () => {
      currentSortMode = currentSortMode === "default" ? "alphabetical" : "default";
      renderCommands();
      showToast("Sortierung: " + (currentSortMode === "alphabetical" ? "Alphabetisch" : "Standard"));
    };

    // Floating Copy Icon – Positionierung und Kopiervorgang
    let scrollTick = false;
    const updateFloatingCopyPosition = () => {
      const cards = document.querySelectorAll(".command-card");
      let activeCard = null;
      let minDistance = Infinity;
      cards.forEach(card => {
        const rect = card.getBoundingClientRect();
        if (rect.top >= 0 && rect.top < minDistance) {
          minDistance = rect.top;
          activeCard = card;
        }
      });
      const floatingCopy = document.getElementById("floatingCopy");
      if (activeCard) {
        const rect = activeCard.getBoundingClientRect();
        floatingCopy.style.top = (rect.top + rect.height / 2 - 15) + "px";
        floatingCopy.setAttribute("data-active", activeCard.getAttribute("data-id"));
        floatingCopy.classList.add("show");
      } else {
        floatingCopy.classList.remove("show");
      }
    };
    document.getElementById("floatingCopy").addEventListener("click", () => {
      const activeId = document.getElementById("floatingCopy").getAttribute("data-active");
      if (activeId) {
        const activeCard = document.querySelector(`.command-card[data-id="${activeId}"]`);
        if (activeCard) {
          const input = activeCard.querySelector(".command-content input[type='text']");
          const text = input.value;
          if (navigator.clipboard) {
            navigator.clipboard.writeText(text)
              .then(() => { showToast("Befehl kopiert!"); showCopySuccess(); })
              .catch(() => showToast("Fehler beim Kopieren."));
          } else {
            const ta = document.createElement("textarea");
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            try { document.execCommand("copy"); showToast("Befehl kopiert!"); showCopySuccess(); }
            catch (err) { showToast("Fehler beim Kopieren."); }
            document.body.removeChild(ta);
          }
        }
      }
    });
    const onScroll = () => {
      if (!scrollTick) {
        window.requestAnimationFrame(() => { updateFloatingCopyPosition(); scrollTick = false; });
        scrollTick = true;
      }
    };
    window.addEventListener("scroll", onScroll);

    // Tastaturkürzel: STRG+F fokussiert Suchfeld
    window.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.key === "f") {
        e.preventDefault();
        document.getElementById("searchInput").focus();
      }
    });

    // Navigation: Top-Menü Buttons
    document.getElementById("topMenuHome").addEventListener("click", () => {
      // Filter und Suche zurücksetzen
      document.getElementById("searchInput").value = "";
      document.getElementById("categoryFilter").value = "";
      currentCategoryFilter = "";
      showFavoritesOnly = false;
      renderCommands();
    });

    document.getElementById("topMenuAbout").addEventListener("click", () => {
      document.getElementById("aboutModal").style.display = "block";
    });
    
    document.getElementById("topMenuHelp").addEventListener("click", () => {
      document.getElementById("helpModal").style.display = "block";
    });

    // Modale Schließen
    document.querySelectorAll(".close-modal").forEach(el => {
      el.addEventListener("click", (e) => {
        const modalId = e.target.getAttribute("data-modal");
        document.getElementById(modalId).style.display = "none";
      });
    });
    // Schließen, wenn außerhalb des Modals geklickt wird
    window.addEventListener("click", (e) => {
      if (e.target.classList.contains("modal")) {
        e.target.style.display = "none";
      }
    });

    // Event-Listener für weitere Elemente
    document.getElementById("searchInput").addEventListener("input", renderCommands);
    document.getElementById("categoryFilter").addEventListener("change", renderCommands);
    document.getElementById("clearCategoryBtn").addEventListener("click", () => { 
      currentCategoryFilter = ""; 
      document.querySelectorAll(".category-item").forEach(el => el.classList.remove("active"));
      renderCommands(); 
    });
    document.getElementById("addCommandBtn").addEventListener("click", addNewCommand);
    document.getElementById("exportBtn").addEventListener("click", exportCommands);
    document.getElementById("resetBtn").addEventListener("click", resetCommands);
    document.getElementById("darkModeBtn").addEventListener("click", toggleDarkMode);
    document.getElementById("favFilterBtn").addEventListener("click", toggleFavFilter);
    document.getElementById("layoutToggleBtn").addEventListener("click", toggleLayout);
    document.getElementById("sortBtn").addEventListener("click", changeSortMode);
    document.getElementById("importBtn").addEventListener("click", () => {
      document.getElementById("fileInput").click();
    });
    document.getElementById("fileInput").addEventListener("change", (e) => {
      if (e.target.files.length > 0) { importCommands(e.target.files[0]); }
    });

    // Initialisierung
    loadCommands();
    renderCommands();
    updateCategoryFilterOptions();
  </script>
</body>
</html>
